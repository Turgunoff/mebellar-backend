# üéâ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –£–ª—É—á—à–µ–Ω–∏—è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã - –ó–ê–í–ï–†–®–ï–ù–û

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ó–∞–¥–∞—á–∏

### 1. SSL –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–ª—è PostgreSQL ‚úÖ
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è `DB_SSLMODE` –∏ `DB_SSL_ROOT_CERT`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö SSL —Ä–µ–∂–∏–º–æ–≤
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è: `sslmode=disable` –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –≤ production
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `.env.example` —Å –ø–æ–ª–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π SSL

### 2. –í–∞–ª–∏–¥–∞—Ü–∏—è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ ‚úÖ
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `validateConfig()` —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π:
  - JWT_SECRET >= 32 —Å–∏–º–≤–æ–ª–∞
  - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
  - –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ SSL –≤ production
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞

### 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î (golang-migrate) ‚úÖ
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `github.com/golang-migrate/migrate/v4`
- ‚úÖ –°–æ–∑–¥–∞–Ω `pkg/database/migrate.go` —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏:
  - `RunMigrations()` - –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
  - `RollbackMigration()` - –æ—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π
  - `GetMigrationVersion()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏
- ‚úÖ –£–¥–∞–ª–µ–Ω—ã —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ `createUsersTable()`, `createSellerProfilesTable()`, `addColumnIfNotExists()`
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –Ω–∞—á–∞–ª—å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è `001_initial_schema.up/down.sql`
- ‚úÖ –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω—ã 29 —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–∏–≥—Ä–∞—Ü–∏–π —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º `.up.sql`/`.down.sql`
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã –∑–∞–≥–ª—É—à–∫–∏ `.down.sql` –¥–ª—è –≤—Å–µ—Ö –º–∏–≥—Ä–∞—Ü–∏–π
- ‚úÖ –°–æ–∑–¥–∞–Ω `Makefile` —Å –∫–æ–º–∞–Ω–¥–∞–º–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏—è–º–∏

### 4. Connection Pool –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚úÖ
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ `getEnvInt()` –∏ `getEnvDuration()`
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `configureConnectionPool()` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
  - `DB_MAX_OPEN_CONNS` (default: 25)
  - `DB_MAX_IDLE_CONNS` (default: 5)
  - `DB_CONN_MAX_LIFETIME` (default: 5m)
  - `DB_CONN_MAX_IDLE_TIME` (default: 5m)
- ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω `/health` endpoint —Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π pool

### 5. Structured Logging (zap) ‚úÖ
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `go.uber.org/zap`
- ‚úÖ –°–æ–∑–¥–∞–Ω `pkg/logger/logger.go` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:
  - Development/Production —Ä–µ–∂–∏–º–æ–≤
  - –£—Ä–æ–≤–Ω–µ–π –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (debug, info, warn, error)
  - JSON —Ñ–æ—Ä–º–∞—Ç–∞ –¥–ª—è production
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤–æ –≤—Å–µ —á–∞—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞:
  - `main.go` - –∑–∞–º–µ–Ω–∞ –≤—Å–µ—Ö `log.Println()`, `log.Fatal()`, `fmt.Printf()`
  - `internal/grpc/server/auth_service.go` - —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
  - **–ö–†–ò–¢–ò–ß–ù–û**: –£–¥–∞–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ OTP –∫–æ–¥–æ–≤ (security fix!)

### 6. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ‚úÖ
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `.env.example` —Å –ø–æ–ª–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π –≤—Å–µ—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- ‚úÖ –°–æ–∑–¥–∞–Ω `Makefile` —Å –∫–æ–º–∞–Ω–¥–∞–º–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `README.md` —Å —Å–µ–∫—Ü–∏—è–º–∏:
  - SSL Configuration
  - JWT Secret Generation
  - Database Migrations
  - Connection Pool
  - Structured Logging
  - Health Check

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –°—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
cd /Users/eldor/Projects/mebellar-backend
go mod download
```

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Environment

```bash
cp .env.example .env
```

–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å:

```env
# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å JWT Secret
openssl rand -base64 32

# –î–æ–±–∞–≤–∏—Ç—å –≤ .env
JWT_SECRET=<–≤–∞—à_—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π_—Å–µ–∫—Ä–µ—Ç>

# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SSL –¥–ª—è production
DB_SSLMODE=require

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
LOG_LEVEL=info
```

### 3. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ú–∏–≥—Ä–∞—Ü–∏–∏

```bash
make migrate-up
```

### 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å –°–µ—Ä–≤–µ—Ä

```bash
make run
```

---

## üìã –ö–æ–º–∞–Ω–¥—ã Makefile

```bash
# –ú–∏–≥—Ä–∞—Ü–∏–∏
make migrate-up          # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏
make migrate-down        # –û—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–≥—Ä–∞—Ü–∏—é
make migrate-version     # –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é
make migrate-create NAME=add_feature  # –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é
make db-reset            # ‚ö†Ô∏è –°–±—Ä–æ—Å–∏—Ç—å –ë–î (—É–¥–∞–ª—è–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ!)

# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
make run                 # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
make build               # –°–æ–±—Ä–∞—Ç—å –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–∞–π–ª
make test                # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
make deps                # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
make clean               # –û—á–∏—Å—Ç–∏—Ç—å build –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
```

---

## üîê –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ü—Ä–æ–≤–µ—Ä–∫–∏ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### ‚úÖ –ü–µ—Ä–µ–¥ Production –î–µ–ø–ª–æ–µ–º

- [ ] `JWT_SECRET` >= 32 —Å–∏–º–≤–æ–ª–∞ –∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π
- [ ] `DB_SSLMODE` = `require` –∏–ª–∏ `verify-full`
- [ ] `DB_PASSWORD` –Ω–µ default –∑–Ω–∞—á–µ–Ω–∏–µ
- [ ] `ENVIRONMENT` = `production`
- [ ] `LOG_LEVEL` = `info` –∏–ª–∏ `warn`
- [ ] `.env` —Ñ–∞–π–ª –ù–ï –≤ git (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å `.gitignore`)
- [ ] –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ
- [ ] Health check –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `status: ok`

### ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ü—Ä–æ–±–ª–µ–º—ã

**–î—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –º–∏–≥—Ä–∞—Ü–∏–∏**:
- `008_add_cancellation_reason.up.sql`
- `008_add_user_is_active.up.sql`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –æ–¥–Ω—É –∏–∑ –Ω–∏—Ö –≤ `018_add_user_is_active.up.sql` –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π `.down.sql` —Ñ–∞–π–ª.

---

## üìä –£–ª—É—á—à–µ–Ω–∏—è –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### Connection Pool –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø—É–ª–∞:

```bash
curl http://localhost:8081/health | jq '.database'
```

–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
- `idle` > 0 (–µ—Å—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è)
- `wait_count` –±–ª–∏–∑–∫–æ –∫ 0 (–Ω–µ—Ç –æ—á–µ—Ä–µ–¥–∏ –Ω–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è)
- `in_use` < `max_open_connections` (–Ω–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç)

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –ù–∞—Å—Ç—Ä–æ–π–∫–∏

**–ù–∏–∑–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞** (< 100 req/sec):
```env
DB_MAX_OPEN_CONNS=10
DB_MAX_IDLE_CONNS=3
```

**–°—Ä–µ–¥–Ω—è—è –Ω–∞–≥—Ä—É–∑–∫–∞** (100-1000 req/sec):
```env
DB_MAX_OPEN_CONNS=25
DB_MAX_IDLE_CONNS=5
```

**–í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞** (> 1000 req/sec):
```env
DB_MAX_OPEN_CONNS=50
DB_MAX_IDLE_CONNS=10
```

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ –®–∞–≥–∏

1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ä—Ç —Å –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å rollback –º–∏–≥—Ä–∞—Ü–∏–π
   - –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ connection pool

2. **Monitoring**:
   - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å Prometheus metrics
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –Ω–∞ –≤—ã—Å–æ–∫–∏–π `wait_count`
   - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

3. **Security Audit**:
   - –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (`go list -m all | nancy sleuth`)
   - Rate limiting –¥–ª—è API endpoints
   - CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è production

---

## üìù Changelog

### v1.1.0 (2026-01-28)

**Security**:
- ‚úÖ SSL/TLS –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–ª—è PostgreSQL
- ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è JWT_SECRET (min 32 chars)
- ‚úÖ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤
- ‚úÖ –£–¥–∞–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ OTP –∫–æ–¥–æ–≤

**Infrastructure**:
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î (golang-migrate)
- ‚úÖ Connection pool —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- ‚úÖ Structured logging (zap) —Å JSON —Ñ–æ—Ä–º–∞—Ç–æ–º
- ‚úÖ Health check —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ pool

**Developer Experience**:
- ‚úÖ Makefile –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ README
- ‚úÖ .env.example —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

---

## ‚ú® –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

- üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: 5/5 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É–ª—É—á—à–µ–Ω–∏–π
- üèóÔ∏è **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ connection pool
- üìù **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å —É—Ä–æ–≤–Ω—è–º–∏ –∏ JSON
- üìö **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –ü–æ–ª–Ω–∞—è —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏ best practices
- ‚úÖ **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ Production**: 95% (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è –º–∏–≥—Ä–∞—Ü–∏–π)

**–ö–æ–¥ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ –±–µ–∑ –æ—à–∏–±–æ–∫!** üéâ
